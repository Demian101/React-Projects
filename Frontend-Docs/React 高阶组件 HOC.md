**HOC: Higher Order Component**

ç±»ä¼¼äºŽ JavaScript ä¸­çš„é«˜é˜¶å‡½æ•°ï¼Œåœ¨ JS ä¸­ï¼Œé«˜é˜¶å‡½æ•°æ˜¯**å°†å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›žå¦ä¸€ä¸ªå‡½æ•°**çš„å‡½æ•°ã€‚

ä¸Žé«˜é˜¶å‡½æ•°ç±»ä¼¼ï¼Œé«˜é˜¶ç»„ä»¶æŽ¥å—ä¸€ä¸ª**ç»„ä»¶**å¹¶è¿”å›žå¦ä¸€ä¸ª**ç»„ä»¶**ã€‚

å¤§å¤šæ—¶å€™ï¼Œç¬¬ä¸‰æ–¹åº“ä¼šä½¿ç”¨é«˜é˜¶ç»„ä»¶ã€‚ä¾‹å¦‚ reduxã€react-router-dom å’Œ material-u éƒ½ç”¨äº†ã€‚

```react
// One way of writing a Higher Order Component(HOC)
import React from 'react'
const higherOrderComponent = (Component) => {
  return (props) => {
    return <Component {...props} />
  }
}
```



```react
const EnhancedComponent = higherOrderComponent(WrappedComponent);
// const "è¢«å¼ºåŒ–ç»„ä»¶" = é«˜é˜¶ç»„ä»¶("è¢«åŒ…è£…ç»„ä»¶")
```





# é«˜é˜¶ç»„ä»¶äº§ç”Ÿåˆè¡·

ç»„ä»¶æ˜¯æŠŠ `props` æ¸²æŸ“æˆ `UI` çš„, è€Œé«˜é˜¶ç»„ä»¶æ˜¯å°†ç»„ä»¶è½¬æ¢æˆå¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬æ›´åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç»è¿‡åŒ…è£…åŽçš„ç»„ä»¶ï¼ŒèŽ·å¾—äº†é‚£äº›å¼ºåŒ–,èŠ‚çœå¤šå°‘é€»è¾‘ï¼Œæˆ–æ˜¯è§£å†³äº†åŽŸæœ‰ç»„ä»¶çš„é‚£äº›ç¼ºé™·ï¼Œè¿™å°±æ˜¯é«˜é˜¶ç»„ä»¶çš„æ„ä¹‰ã€‚é«˜é˜¶ç»„ä»¶ç©¶ç«Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ ðŸ¤”ðŸ¤”ðŸ¤”ï¼Ÿ

**â‘  å¤ç”¨é€»è¾‘**ï¼šé«˜é˜¶ç»„ä»¶æ›´åƒæ˜¯ä¸€ä¸ªåŠ å·¥`react`ç»„ä»¶çš„å·¥åŽ‚ï¼Œæ‰¹é‡å¯¹åŽŸæœ‰ç»„ä»¶è¿›è¡Œ**åŠ å·¥**ï¼Œ**åŒ…è£…**å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶åŒ–ä¸“å±žçš„`HOC`,è¿™æ ·å¯ä»¥è§£å†³å¤ç”¨é€»è¾‘ã€‚

**â‘¡ å¼ºåŒ– props **ï¼šè¿™ä¸ªæ˜¯`HOC`æœ€å¸¸ç”¨çš„ç”¨æ³•ä¹‹ä¸€ï¼Œé«˜é˜¶ç»„ä»¶è¿”å›žçš„ç»„ä»¶ï¼Œå¯ä»¥åŠ«æŒä¸Šä¸€å±‚ä¼ è¿‡æ¥çš„`props`,ç„¶åŽæ··å…¥æ–°çš„`props`,æ¥å¢žå¼ºç»„ä»¶çš„åŠŸèƒ½ã€‚ä»£è¡¨ä½œ`react-router`ä¸­çš„`withRouter`ã€‚

**â‘¢ èµ‹èƒ½ç»„ä»¶**ï¼š`HOC`æœ‰ä¸€é¡¹ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥ç»™è¢«`HOC`åŒ…è£¹çš„ä¸šåŠ¡ç»„ä»¶ï¼Œæä¾›ä¸€äº›æ‹“å±•åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´**é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¢å¤–çš„äº‹ä»¶**ï¼Œä½†æ˜¯è¿™ç§`HOC`ï¼Œå¯èƒ½éœ€è¦å’Œä¸šåŠ¡ç»„ä»¶ç´§å¯†ç»“åˆã€‚å…¸åž‹æ¡ˆä¾‹`react-keepalive-router`ä¸­çš„ `keepaliveLifeCycle`å°±æ˜¯é€šè¿‡`HOC`æ–¹å¼ï¼Œç»™ä¸šåŠ¡ç»„ä»¶å¢žåŠ äº†é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸã€‚

**â‘£ æŽ§åˆ¶æ¸²æŸ“**ï¼šåŠ«æŒæ¸²æŸ“æ˜¯`hoc`ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨`wrapComponent`åŒ…è£…ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¯¹åŽŸæ¥çš„ç»„ä»¶ï¼Œè¿›è¡Œ`æ¡ä»¶æ¸²æŸ“`ï¼Œ`èŠ‚æµæ¸²æŸ“`ï¼Œ`æ‡’åŠ è½½`ç­‰åŠŸèƒ½ï¼ŒåŽé¢ä¼šè¯¦ç»†è®²è§£ï¼Œå…¸åž‹ä»£è¡¨åš`react-redux`ä¸­`connect`å’Œ `dva`ä¸­ `dynamic` ç»„ä»¶æ‡’åŠ è½½ã€‚

æˆ‘ä¼šé’ˆå¯¹é«˜é˜¶ç»„ä»¶çš„åˆè¡·å±•å¼€ï¼Œè¯¦ç»†ä»‹ç»å…¶åŽŸç†å·²ç»ç”¨æ³•ã€‚è·Ÿä¸Šæˆ‘çš„æ€è·¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œé«˜é˜¶ç»„ä»¶**å¦‚ä½•åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ä¸­ä½¿ç”¨çš„**ã€‚

> è¿™ç§è®¾è®¡æ¨¡å¼æ˜¯è£…é¥°æ¨¡å¼ï¼šè£…é¥°æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦æ”¹å˜ è¢«è£…é¥°å¯¹è±¡ æœ¬èº«ï¼Œè€Œåªæ˜¯åœ¨å¤–é¢å¥—ä¸€ä¸ªå¤–å£³æŽ¥å£ã€‚



# å®žä¾‹ 1 

`withxxx`  æ˜¯é«˜é˜¶ç»„ä»¶çš„å‘½åè§„èŒƒï¼Œå¦‚ä¸‹ `withFetch` ç»„ä»¶ï¼Œå®ƒå°è£…äº† axios è¯·æ±‚ url çš„é€»è¾‘ï¼Œå¹¶å°†æ•°æ®çŠ¶æ€ data å­˜å‚¨åœ¨ class ä¸­ã€‚

è¿™ä½¿å¾—æ— è®ºæ˜¯ä»Ž URL_A èŽ·å–æ•°æ®æ˜¾ç¤ºå›¾ç‰‡ï¼Œè¿˜æ˜¯ä»Ž URL_B èŽ·å–æ•°æ®æ˜¾ç¤ºä¹¦ç±ï¼Œéƒ½å¯ä»¥ä½¿ç”¨é«˜é˜¶ç»„ä»¶åŒ…è£…çš„ fetch é€»è¾‘ï¼Œå…¶åŒºåˆ«åªä¸è¿‡æ˜¯ URL ä¸åŒç½¢äº†ã€‚

```react 
import { React } from 'react';

const withFetch = (Component, url) => {
  return class WithFetchComponent extends React.Component{
    state = { list: [] }
    async componentDidMount() {
      const {data: list} = await axios.get(url)
      this.setState({ list })
    }
    render(){
      return <Component {...this.porps} list={this.state.list} /> 
    }
  }
}
export default withFetch;
```



PhotoList ä½¿ç”¨ HOC åŒ…è£…è‡ªå·±ï¼Œ

1. åœ¨ HOC ä¸­ fetch æ•°æ®
2. æŠŠæ•°æ®æ‹¿å›žæ¥è¿›è¡Œæ¸²æŸ“ã€‚

```react
const url = ' https://jsonplaceholder.typicode.com/photos?_limit=5
const PhotoList = ( {list} ) => {
  return (
    <ul>
      {list.map((photo) => {
        return <li key={photo.id}> å›¾ç‰‡ URL æ˜¯: {photo.url} </li>
      })}
    </ul>
}
export default withFetch(PhotoList, url)
```



